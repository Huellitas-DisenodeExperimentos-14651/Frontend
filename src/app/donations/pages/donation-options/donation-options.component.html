<div class="donation-wrapper">
  <div class="donation-header">
    <div>
      <h2>Apoya a una mascota</h2>
      <p class="lead">Elige una mascota disponible y el método de pago que ya tienes registrado. Puedes seleccionar un monto rápido o escribir uno personalizado.</p>
    </div>
    <div class="help-area">
      <button class="help-btn" (click)="toggleHelp()">Ayuda</button>
    </div>
  </div>

  <div class="content">
    <section class="pets-section">
      <h3>Mascotas disponibles</h3>
      <div class="pet-grid">
        <div *ngFor="let pet of pets" class="pet-card" [class.selected]="pet.id === selectedPetId" (click)="selectedPetId = pet.id">
          <img *ngIf="pet.photo" [src]="pet.photo" alt="{{pet.name}}" />
          <div class="pet-name">{{ pet.name }}</div>
          <div class="select-indicator">{{ pet.id === selectedPetId ? 'Seleccionada' : 'Seleccionar' }}</div>
        </div>
        <div *ngIf="!pets || pets.length === 0" class="no-pets">No hay mascotas disponibles por ahora.</div>
      </div>
    </section>

    <aside class="controls">
      <div class="payment-block">
        <h4>Método de pago</h4>
        <div *ngIf="paymentMethods && paymentMethods.length > 0" class="methods">
          <select [(ngModel)]="selectedPaymentMethod">
            <option *ngFor="let m of paymentMethods" [value]="m">{{ m | uppercase }}</option>
          </select>
          <button class="edit-profile" (click)="goToProfile()">Editar métodos</button>
        </div>
        <div *ngIf="!paymentMethods || paymentMethods.length === 0" class="no-methods">
          No tienes métodos registrados. Ve a tu perfil para configurarlos.
          <button class="edit-profile" (click)="goToProfile()">Ir al perfil</button>
        </div>
      </div>

      <div class="amount-block">
        <h4>Monto</h4>
        <div class="quick-amounts">
          <button *ngFor="let a of quickAmounts" (click)="selectQuickAmount(a)" [class.active]="selectedAmount===a">S/. {{ a }}</button>
        </div>
        <div class="custom-amount">
          <label>Otro monto</label>
          <input type="number" min="1" (input)="onCustomAmountInput($event)" placeholder="Ej: 30" />
        </div>
      </div>

      <div class="actions">
        <button class="donate" (click)="donate()" [disabled]="loading">
          {{ loading ? 'Donando...' : (selectedAmount || customAmount ? ('Donar S/. ' + (selectedAmount || customAmount)) : 'Donar') }}
        </button>
      </div>

      <div class="help-text" *ngIf="showHelp">
        <h4>¿Cómo funciona?</h4>
        <p>Selecciona la mascota, el método de pago que ya tengas registrado y el monto. Pulsa "Donar" y recibirás una confirmación en pantalla.</p>
        <p>Si no tienes métodos registrados, haz clic en "Editar métodos" para agregarlos en tu perfil.</p>
      </div>
    </aside>
  </div>
</div>
