<div class="profile-container">
  <!-- Mostrar cuando hay un usuario cargado -->
  <div *ngIf="user && !isLoading" class="user-card">
    <!-- Modo visualizaciÃ³n -->
    <div *ngIf="!isEditMode">
      <div class="user-header">
        <img *ngIf="user.profilePic" [src]="user.profilePic" alt="Foto de perfil" class="profile-pic">
        <h3>{{ user.name }}</h3>
        <span class="user-role">{{ user.role }}</span>
      </div>

      <div class="user-info">
        <p><strong>ğŸ“ UbicaciÃ³n:</strong> {{ user.address }}</p>
        <p><strong>âœ‰ï¸ Email:</strong> {{ user.email }}</p>
        <p *ngIf="user.bio" class="user-bio">{{ user.bio }}</p>
      </div>

      <div *ngIf="user.preferences?.length" class="preferences">
        <h4>ğŸ” Preferencias:</h4>
        <div class="preferences-container">
          <span class="preference-tag" *ngFor="let pref of user.preferences">
            {{ pref }}
          </span>
        </div>
      </div>

      <!-- Campos especÃ­ficos por rol -->
      <div *ngIf="user.role === 'SHELTER'" class="role-specific">
        <p><strong>ğŸ  Capacidad:</strong> {{ user.capacity }} animales</p>
        <p><strong>ğŸ¾ Disponibles:</strong> {{ user.animalsAvailable }}</p>
      </div>

      <div *ngIf="user.role === 'ADOPTER'" class="role-specific">
        <p><strong>ğŸ¡ Tipo de vivienda:</strong> {{ user.homeType }}</p>
        <p><strong>ğŸ“Œ Experiencia previa:</strong> {{ user.previousExperience || 'Ninguna' }}</p>
      </div>

      <!-- MÃ©todos de pago -->
      <div *ngIf="user.paymentMethods?.length" class="payment-methods">
        <h4>ğŸ’³ MÃ©todos de pago:</h4>
        <div class="methods-container">
          <span class="method-tag" *ngFor="let method of user.paymentMethods">
            {{ method }}
          </span>
        </div>
      </div>

      <div class="actions">
        <button (click)="toggleEditMode()" class="edit-button">
          <mat-icon>edit</mat-icon> Editar Perfil
        </button>
        <button (click)="deleteProfile()" class="delete-button">
          <mat-icon>delete</mat-icon> Eliminar Perfil
        </button>
      </div>
    </div>

    <!-- Modo ediciÃ³n -->
    <div *ngIf="isEditMode" class="edit-form">
      <h3>Editar Perfil</h3>

      <div class="form-group">
        <label>Nombre:</label>
        <input [(ngModel)]="user.name" type="text">
      </div>

      <div class="form-group">
        <label>Email:</label>
        <input [(ngModel)]="user.email" type="email">
      </div>

      <div class="form-group">
        <label>DirecciÃ³n:</label>
        <input [(ngModel)]="user.address" type="text">
      </div>

      <div class="form-group">
        <label>Preferencias (separadas por coma):</label>
        <input
          [(ngModel)]="user.preferencesString"
          type="text"
          placeholder="Ej: Perros, Gatos, Animales grandes"
        >
        <small>Separa cada elemento con una coma. Ej: "Perros, Gatos"</small>
      </div>

      <div class="form-group">
        <label>MÃ©todos de pago (separados por coma):</label>
        <input
          [(ngModel)]="user.paymentMethodsString"
          type="text"
          placeholder="Ej: PayPal, Tarjeta de crÃ©dito"
        >
        <small>Separa cada mÃ©todo con una coma. Ej: "PayPal, Tarjeta"</small>
      </div>

      <div class="form-group">
        <label>Foto de perfil (URL):</label>
        <input [(ngModel)]="user.profilePic" type="text">
      </div>

      <div class="form-group">
        <label>BiografÃ­a:</label>
        <textarea [(ngModel)]="user.bio"></textarea>
      </div>

      <div *ngIf="user.role === 'SHELTER'" class="form-group">
        <label>Capacidad:</label>
        <input [(ngModel)]="user.capacity" type="number">
      </div>

      <div *ngIf="user.role === 'ADOPTER'" class="form-group">
        <label>Tipo de vivienda:</label>
        <input [(ngModel)]="user.homeType" type="text">
      </div>

      <div class="form-actions">
        <button (click)="saveProfile()" class="save-button">
          <mat-icon>save</mat-icon> Guardar
        </button>
        <button (click)="toggleEditMode()" class="cancel-button">
          <mat-icon>cancel</mat-icon> Cancelar
        </button>
      </div>
    </div>
  </div>

  <!-- Mostrar cuando estÃ¡ cargando -->
  <div *ngIf="isLoading" class="loading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Cargando perfil...</p>
  </div>

  <!-- Mostrar cuando hay error -->
  <div *ngIf="errorLoading && !isLoading" class="error-loading">
    <mat-icon class="error-icon">error_outline</mat-icon>
    <p>No se pudo cargar el perfil</p>
    <button (click)="retryLoadProfile()" class="retry-button">
      <mat-icon>refresh</mat-icon> Reintentar
    </button>
  </div>
</div>
