<div class="profile-container">
  <!-- Mostrar cuando hay un usuario cargado -->
  <div *ngIf="user && !isLoading" class="user-card">
    <!-- Modo visualizaci贸n -->
    <div *ngIf="!isEditMode">
      <div class="user-header">
        <img *ngIf="user.profilePic" [src]="user.profilePic" alt="Foto de perfil" class="profile-pic">
        <h3>{{ user.name }}</h3>
        <span class="user-role">{{ user.role }}</span>
      </div>

      <div class="user-info">
        <p><strong> Ubicaci贸n:</strong> {{ user.address }}</p>
        <p><strong>锔 Email:</strong> {{ user.email }}</p>
        <p *ngIf="user.bio" class="user-bio">{{ user.bio }}</p>
      </div>

      <div *ngIf="user.preferences?.length" class="preferences">
        <h4> Preferencias:</h4>
        <div class="preferences-container">
          <span class="preference-tag" *ngFor="let pref of user.preferences">
            {{ pref }}
          </span>
        </div>
      </div>

      <!-- Campos espec铆ficos por rol -->
      <div *ngIf="user.role === 'SHELTER'" class="role-specific">
        <p><strong> Capacidad:</strong> {{ user.capacity }} animales</p>
        <p><strong> Disponibles:</strong> {{ user.animalsAvailable }}</p>
      </div>

      <div *ngIf="user.role === 'ADOPTER'" class="role-specific">
        <p><strong> Tipo de vivienda:</strong> {{ user.homeType }}</p>
        <p><strong> Experiencia previa:</strong> {{ user.previousExperience || 'Ninguna' }}</p>
      </div>

      <!-- M茅todos de pago -->
      <div *ngIf="user.paymentMethods?.length" class="payment-methods">
        <h4> M茅todos de pago:</h4>
        <div class="methods-container">
          <span class="method-tag" *ngFor="let method of user.paymentMethods">
            {{ method }}
          </span>
        </div>
      </div>

      <div class="actions">
        <button (click)="toggleEditMode()" class="edit-button">
          <mat-icon>edit</mat-icon> Editar Perfil
        </button>
        <button (click)="openPaymentMethodsDialog()" class="payment-button">
          <mat-icon>payment</mat-icon> Editar m茅todos de pago
        </button>
      </div>
    </div>

    <!-- Modo edici贸n -->
    <div *ngIf="isEditMode" class="edit-form">
      <h3>Editar Perfil</h3>

      <div class="form-group">
        <label>Nombre:</label>
        <input [(ngModel)]="user.name" type="text">
      </div>

      <div class="form-group">
        <label>Email:</label>
        <input [(ngModel)]="user.email" type="email">
      </div>

      <div class="form-group">
        <label>Direcci贸n:</label>
        <input [(ngModel)]="user.address" type="text">
      </div>

      <div class="form-group">
        <label>Preferencias (separadas por coma):</label>
        <input
          [(ngModel)]="user.preferencesString"
          type="text"
          placeholder="Ej: Perros, Gatos, Animales grandes"
        >
        <small>Separa cada elemento con una coma. Ej: "Perros, Gatos"</small>
      </div>

      <div class="form-group">
        <label>Foto de perfil (URL):</label>
        <input [(ngModel)]="user.profilePic" type="text">
      </div>

      <div class="form-group">
        <label>Biograf铆a:</label>
        <textarea [(ngModel)]="user.bio"></textarea>
      </div>

      <div *ngIf="user.role === 'SHELTER'" class="form-group">
        <label>Capacidad:</label>
        <input [(ngModel)]="user.capacity" type="number">
      </div>

      <div *ngIf="user.role === 'ADOPTER'" class="form-group">
        <label>Tipo de vivienda:</label>
        <input [(ngModel)]="user.homeType" type="text">
      </div>

      <div *ngIf="user.role === 'ADOPTER'" class="form-group">
        <label>Experiencia previa:</label>
        <input [(ngModel)]="user.previousExperience" type="text">
      </div>

      <!-- Nueva secci贸n: confirmaci贸n de contrase帽a para aplicar cambios -->
      <div class="form-group">
        <label>Ingresa tu contrase帽a actual para confirmar cambios:</label>
        <input [(ngModel)]="confirmPassword" type="password" placeholder="Contrase帽a actual">
        <small *ngIf="passwordError" class="password-error">{{ passwordError }}</small>
      </div>

      <div class="form-actions">
        <button (click)="saveProfile()" class="save-button">
          <mat-icon>save</mat-icon> Guardar
        </button>
        <button (click)="toggleEditMode()" class="cancel-button">
          <mat-icon>cancel</mat-icon> Cancelar
        </button>
      </div>

      <p class="note">Para modificar m茅todos de pago, ve a la secci贸n <a (click)="goToPaymentSettings()">Configurar m茅todos de pago</a>.</p>
    </div>
  </div>

  <!-- Mostrar cuando est谩 cargando -->
  <div *ngIf="isLoading" class="loading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Cargando perfil...</p>
  </div>

  <!-- Mostrar cuando hay error -->
  <div *ngIf="errorLoading && !isLoading" class="error-loading">
    <mat-icon class="error-icon">error_outline</mat-icon>
    <p>No se pudo cargar el perfil</p>
    <button (click)="retryLoadProfile()" class="retry-button">
      <mat-icon>refresh</mat-icon> Reintentar
    </button>
  </div>
</div>
