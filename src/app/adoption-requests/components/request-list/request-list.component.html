<section class="requests">
  <ul>
    <li *ngFor="let r of requests"
        (click)="openDetail(r)"
        [class.processed]="r.status !== 'PENDING'">

      <strong>#{{ r.id }}</strong>
      <span>{{ r.applicantFullName }}</span>

      <!-- hint traducido -->
      <small class="hint">{{ 'adoption.hint.moreInfo' | translate }}</small>

      <!-- badge traducido -->
      <small class="badge"
             [attr.data-status]="r.status">
        {{ ('adoption.status.' + r.status) | translate }}
      </small>
    </li>
  </ul>
</section>

<div class="backdrop" *ngIf="open()" (click)="close()"></div>
<dialog open *ngIf="open() as s" class="popup">
  <ng-container *ngIf="s.pet">
    <div class="pet-detail">
      <img *ngIf="s.pet.photo" [src]="s.pet.photo" alt="Mascota" class="pet-photo" />
      <div class="pet-info">
        <div><strong>Nombre:</strong> {{ s.pet.name }}</div>
        <div><strong>Raza:</strong> {{ s.pet.breed }}</div>
        <div><strong>Edad:</strong> {{ s.pet.age }}</div>
      </div>
    </div>
  </ng-container>

  <div class="applicant-detail" *ngIf="s.applicantProfile">
    <h3>Solicitante</h3>
    <div><strong>Nombre:</strong> {{ s.applicantProfile.name || s.applicantFullName }}</div>
    <div><strong>Email:</strong> {{ s.applicantProfile.email }}</div>
    <div *ngIf="s.applicantProfile.bio"><strong>Bio:</strong> {{ s.applicantProfile.bio }}</div>
  </div>

  <p><b>Fecha de solicitud:</b> {{ s.requestDate }}</p>
  <p><b>Estado:</b> {{ s.status | uppercase }}</p>

  <!-- Controles disponibles solo para el refugio -->
  <footer *ngIf="isShelter">
    <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
      <!-- Aprobar / Rechazar solo si est치 pendiente -->
      <button *ngIf="s.status === 'PENDING'" (click)="approve(s)">{{ 'adoption.actions.approve' | translate }}</button>
      <button *ngIf="s.status === 'PENDING'" (click)="reject(s)">{{ 'adoption.actions.reject' | translate }}</button>

      <!-- Agendar entrevista: input fecha + bot칩n -->
      <div *ngIf="s.status === 'PENDING' || s.status === 'INTERVIEW'" style="display:flex; gap:6px; align-items:center;">
        <input type="date" [(ngModel)]="selectedDate" />
        <button *ngIf="s.status !== 'INTERVIEW'" (click)="scheduleInterview(s)" [disabled]="!selectedDate">{{ 'adoption.actions.schedule' | translate }}</button>
      </div>

      <!-- Bot칩n concretado solo si ya est치 en INTERVIEW -->
      <button *ngIf="s.status === 'INTERVIEW'" (click)="complete(s)">{{ 'adoption.actions.completed' | translate }}</button>

      <button class="back" (click)="close()">{{ 'common.back' | translate }}</button>
    </div>
  </footer>

  <!-- Para usuarios normales solo volver -->
  <footer *ngIf="!isShelter">
    <button class="back" (click)="close()">{{ 'common.back' | translate }}</button>
  </footer>
</dialog>
